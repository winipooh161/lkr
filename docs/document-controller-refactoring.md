# Рефакторинг контроллера документов

## Обзор

Этот рефакторинг был выполнен для уменьшения размера основного контроллера `ProjectDocumentController` и улучшения модульности кода.

## Структура

### Старая структура
```
app/Http/Controllers/Partner/
├── ProjectDocumentController.php (2056 строк)
```

### Новая структура
```
app/Http/Controllers/Partner/
├── ProjectDocumentController.php (1811 строк) - Основной контроллер
└── ProjectDocuments/
    ├── BaseDocumentController.php (200 строк) - Базовый абстрактный класс
    └── CompletionActIpIpController.php (290 строк) - Контроллер для акта завершения ИП-ИП
```

## Изменения

### 1. Базовый контроллер (BaseDocumentController)

Создан абстрактный базовый класс, содержащий:
- Общие методы для генерации подписей и печатей
- Методы генерации PDF и DOCX
- Абстрактные методы, которые должны реализовать дочерние контроллеры

### 2. Специализированный контроллер (CompletionActIpIpController)

Наследуется от `BaseDocumentController` и содержит:
- Логику генерации "Акта завершения ремонта ИП-ИП"
- Метод для прямой генерации документа из HTTP-запроса
- HTML-шаблон документа

### 3. Маршруты

Добавлены новые маршруты:
```php
// Новый специализированный маршрут
POST /partner/projects/{project}/documents/completion-act-ip-ip/generate

// Старый общий маршрут (для остальных типов документов)
POST /partner/projects/{project}/documents/generate
```

### 4. Frontend

Обновлена логика выбора URL на фронтенде:
- Для типа `completion_act_ip_ip` используется новый специализированный контроллер
- Для остальных типов используется старый общий контроллер

## Преимущества

1. **Уменьшение размера**: Основной контроллер уменьшен на 245 строк
2. **Модульность**: Каждый тип документа может иметь свой контроллер
3. **Расширяемость**: Легко добавлять новые типы документов
4. **Обратная совместимость**: Старые маршруты продолжают работать

## Дальнейшее развитие

Можно аналогично перенести другие типы документов:
- `CompletionActFlIpController` - для акта завершения ФЛ-ИП
- `ActIpIpController` - для акта выполненных работ ИП-ИП
- `ActFlIpController` - для акта выполненных работ ФЛ-ИП
- `BsoController` - для БСО
- `InvoiceIpController` - для счета ИП
- `InvoiceFlController` - для счета ФЛ

## Использование

### Для разработчиков

1. При добавлении нового типа документа:
   - Создайте новый контроллер, наследующий от `BaseDocumentController`
   - Реализуйте абстрактные методы
   - Добавьте маршрут в отдельный файл
   - Обновите фронтенд для использования нового маршрута

### Для тестирования

Все существующие документы должны продолжать работать без изменений. Новый контроллер для `completion_act_ip_ip` работает через специализированный маршрут.
